<!-- testimonial Section -->
<section class="wrapper-column" id="testimonial">
  <div class="wrapper-content">
    <div class="testimonial-header">
      <h2 class="content-title">
        <i class="fas fa-quote-left testimonial-quote-icon"></i>
        What Clients Say
      </h2>
      <p class="content-text">
        We offer extensive medical procedures to outbound and inbound patients.
      </p>
    </div>

    <div class="testimonial-container">
      <div class="testimonial-grid">
        <div class="image-container" id="image-container">
          <!-- Images will be dynamically loaded here -->
        </div>

        <div class="testimonial-content">
          <div class="testimonial-text-wrapper">
            <div class="testimonial-quote-mark">
              <i class="fas fa-quote-right"></i>
            </div>
            <h3 class="name" id="name">
              <i class="fas fa-user-circle"></i>
              <span class="name-text"></span>
            </h3>
            <p class="designation" id="designation">
              <i class="fas fa-briefcase"></i>
              <span class="designation-text"></span>
            </p>
            <p class="quote" id="quote"></p>
          </div>

          <div class="arrow-buttons">
            <button
              class="arrow-button prev-button"
              id="prev-button"
              aria-label="Previous testimonial"
            >
              <i class="fa fa-angle-left" aria-hidden="true"></i>
            </button>
            <button
              class="arrow-button next-button"
              id="next-button"
              aria-label="Next testimonial"
            >
              <i class="fa fa-angle-right" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const testimonials = [
    {% for t in testimonials %}
    {
      quote: "{{ t.quote|escapejs }}",
      name: "{{ t.name|escapejs }}",
      designation: "{{ t.designation|escapejs }}",
      src: "{% if t.profile_pic %}{{ t.profile_pic.url }}{% else %}/static/images/default-avatar.jpg{% endif %}",
    },
    {% endfor %}
  ];
  


  let activeIndex = 0;
  const imageContainer = document.getElementById("image-container");
  const nameElement = document.getElementById("name");
  const designationElement = document.getElementById("designation");
  const quoteElement = document.getElementById("quote");
  const prevButton = document.getElementById("prev-button");
  const nextButton = document.getElementById("next-button");

  function updateTestimonial(direction) {
    const oldIndex = activeIndex;
    activeIndex =
      (activeIndex + direction + testimonials.length) % testimonials.length;

    testimonials.forEach((testimonial, index) => {
      let img = imageContainer.querySelector(`[data-index="${index}"]`);
      if (!img) {
        img = document.createElement("img");
        img.src = testimonial.src;
        img.alt = testimonial.name;
        img.classList.add("testimonial-image");
        img.dataset.index = index;
        imageContainer.appendChild(img);
      }

      const offset = index - activeIndex;
      const absOffset = Math.abs(offset);
      const zIndex = testimonials.length - absOffset;
      const opacity = index === activeIndex ? 1 : 0.7;
      const scale = 1 - absOffset * 0.15;
      const translateY = offset === -1 ? "-20%" : offset === 1 ? "20%" : "0%";
      const rotateY =
        offset === -1 ? "15deg" : offset === 1 ? "-15deg" : "0deg";

      img.style.zIndex = zIndex;
      img.style.opacity = opacity;
      img.style.transform = `translateY(${translateY}) scale(${scale}) rotateY(${rotateY})`;
    });

    nameElement.textContent = testimonials[activeIndex].name;
    designationElement.textContent = testimonials[activeIndex].designation;
    quoteElement.innerHTML = testimonials[activeIndex].quote
      .split(" ")
      .map((word) => `<span class="word">${word}</span>`)
      .join(" ");

    animateWords();
  }

  function animateWords() {
    const words = quoteElement.querySelectorAll(".word");
    words.forEach((word, index) => {
      word.style.opacity = "0";
      word.style.transform = "translateY(10px)";
      word.style.filter = "blur(10px)";
      setTimeout(() => {
        word.style.transition =
          "opacity 0.2s ease-in-out, transform 0.2s ease-in-out, filter 0.2s ease-in-out";
        word.style.opacity = "1";
        word.style.transform = "translateY(0)";
        word.style.filter = "blur(0)";
      }, index * 20);
    });
  }

  function handleNext() {
    updateTestimonial(1);
  }

  function handlePrev() {
    updateTestimonial(-1);
  }

  prevButton.addEventListener("click", handlePrev);
  nextButton.addEventListener("click", handleNext);

  // Initial setup
  updateTestimonial(0);

  // Autoplay functionality
  const autoplayInterval = setInterval(handleNext, 5000);

  // Stop autoplay on user interaction
  [prevButton, nextButton].forEach((button) => {
    button.addEventListener("click", () => {
      clearInterval(autoplayInterval);
    });
  });
</script>
